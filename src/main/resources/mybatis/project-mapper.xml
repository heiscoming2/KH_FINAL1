<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="Project">
	
	<insert id ="insert" parameterType="projectInsertDto" >
		INSERT ALL
		INTO BOARD VALUES(
		BOARDSEQ.NEXTVAL, #{bd_title}, #{bd_content}, SYSDATE, NULL,
		0, #{bd_writerip}, 1, #{m_no})
		INTO PROJECT VALUES(
		PROJECTSEQ.NEXTVAL,
		#{pro_title}, #{pro_start}, #{pro_end}, #{pro_link}, #{pro_develop},
		#{pro_goal}, #{pro_function}, #{pro_erd}, BOARDSEQ.CURRVAL)
		
		SELECT * FROM DUAL
	</insert>
	

	
		<select id="selectList" resultType="ProjectListDto" parameterType="hashMap">		 
		 SELECT * FROM
          (SELECT ROWNUM RN, A.* 
               FROM (
                     SELECT B.BD_NO, P.PRO_TITLE, P.PRO_LINK, P.PRO_DEVELOP, 
	          		 P.PRO_GOAL, P.PRO_FUNCTION, P.PRO_ERD, B.BD_TITLE,
                     DECODE(RE.REPLYCOUNT,NULL,0,RE.REPLYCOUNT) BD_REPLYCOUNT, B.BD_VIEWCOUNT,
                     DECODE(BR.RECOMMANDCOUNT,NULL,0,BR.RECOMMANDCOUNT) BD_RECOMMANDCOUNT, M.M_IMG_PATH,
            		 M.M_IMG,M.M_NICKNAME,B.BD_CREATEDDATE
                     FROM BOARD B, PROJECT P, IT_MEMBER M , 
                       (SELECT BD_NO,COUNT(BD_NO) REPLYCOUNT FROM REPLY GROUP BY BD_NO) RE,
                       (SELECT BD_NO,COUNT(BD_NO) RECOMMANDCOUNT FROM BOARDRECOMMAND GROUP BY BD_NO) BR
            		 WHERE B.BD_NO = P.BD_NO 
           		  AND B.BC_CODE=1
           		  AND B.M_NO = M.M_NO
                      AND RE.BD_NO(+) = B.BD_NO
                      AND BR.BD_NO(+) = B.BD_NO
             		ORDER BY B.BD_CREATEDDATE DESC) A  
    				ORDER BY RN ASC) 
				WHERE RN BETWEEN #{start} AND #{end}
       
	</select>
	
	<select id="selectone" resultType="ProjectDetailDto" parameterType="int">
		SELECT M.M_IMG_PATH, M.M_IMG, M.M_NICKNAME, B.BD_CREATEDDATE, B.BD_MODIFYDATE, 
		       B.BD_NO, B.BD_TITLE, B.BD_CONTENT, 
		       (SELECT COUNT(BD_NO) FROM BOARDRECOMMAND R WHERE R.BD_NO=${bd_no}) BD_RECOMMANDCOUNT, 
		       P.PRO_TITLE, P.PRO_LINK, P.PRO_DEVELOP, 
	           P.PRO_GOAL, P.PRO_FUNCTION, P.PRO_ERD
		FROM BOARD B, PROJECT P, IT_MEMBER M
		WHERE B.BD_NO = P.BD_NO
		  AND B.M_NO = M.M_NO
		  AND B.BD_NO = #{bd_no}
	</select>
	
	<select id="selectlistcnt" resultType="int">
		SELECT COUNT(BD_NO)
		FROM BOARD
		WHERE BC_CODE=1
	</select>
	
	<delete id="delete" parameterType="int">
		DELETE FROM PROJECT
	</delete>
	
	<update id="update" parameterType="projectUpdateDto">
		UPDATE PROJECT
		SET PRO_TITLE = #{pro_title},
		    PRO_LINK = #{pro_link},
		    PRO_DEVELOP = #{pro_develop},
		    PRO_GOAL = #{pro_goal},
		    PRO_FUNCTION = #{pro_function},
		    PRO_ERD = #{pro_erd}
		WHERE BD_NO = #{bd_no}
	</update>
	
	
	
</mapper>